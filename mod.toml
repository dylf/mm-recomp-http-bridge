[manifest]
id = "mm_recomp_http_bridge"
version = "0.0.1"

display_name = "MM HTTP Bridge"
description =  """
Expose a local-only HTTP server to read game state and send messages to the game.
Includes simple auth via X-Api-Key and a minimal JSON API.
"""
short_description = "Local HTTP server bridge for game state + messages."

authors = [ "dylf" ]

game_id = "mm"
minimum_recomp_version = "1.2.2"

dependencies = [
# Example dependency:
#    "modname:1.0.0"
]

# Optional dependency mods. This has the same format as `dependencies`, but the game will still start if dependencies in this
# list aren't present. You can query the presence of a given dependency by using `recomp_is_dependency_met` in recomputils.h.
# Calling a function imported from an optional dependency that isn't present will trigger an error.
optional_dependencies = [

]

# Native libraries (e.g. DLLs) and the functions they export.
native_libraries = [
   { name = "mm_recomp_http_bridge_extlib", funcs = ["http_server_start", "http_server_stop", "http_server_set_snapshot", "http_server_pop_message"] }
]

# Inputs to the mod tool.
[inputs]

# Input elf file to generate a mod from.
elf_path = "build/mod/mod.elf"

# Output mod filename.
mod_filename = "mm_recomp_http_bridge"

# Reference symbol files.
func_reference_syms_file = "Zelda64RecompSyms/mm.us.rev1.syms.toml"
data_reference_syms_files = [ "Zelda64RecompSyms/mm.us.rev1.datasyms.toml", "Zelda64RecompSyms/mm.us.rev1.datasyms_static.toml" ]

# Additional files to include in the mod.
additional_files = [ ]

# Mod config options
[[manifest.config_options]]
id = "server_enabled"
name = "Server Enabled"
description = "Enable the HTTP server."
type = "Enum"
options = [ "Off", "On" ]
default = "Off"

[[manifest.config_options]]
id = "bind_address"
name = "Bind Address"
description = "Address to bind the server (use 127.0.0.1 for local-only)."
type = "String"
default = "127.0.0.1"

[[manifest.config_options]]
id = "port"
name = "Port"
description = "TCP port for the HTTP server."
type = "Number"
min = 1
max = 65535
step = 1
precision = 0
percent = false
default = 6464

[[manifest.config_options]]
id = "api_key"
name = "API Key"
description = "Required X-Api-Key header value."
type = "String"
default = "changeme"

[[manifest.config_options]]
id = "snapshot_rate"
name = "Snapshot Rate"
description = "Frames between state snapshot updates."
type = "Number"
min = 1
max = 60
step = 1
precision = 0
percent = false
default = 5

[[manifest.config_options]]
id = "max_message_length"
name = "Max Message Length"
description = "Maximum number of characters accepted in /v1/message."
type = "Number"
min = 32
max = 512
step = 1
precision = 0
percent = false
default = 200
